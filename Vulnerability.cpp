#include "Vulnerability.h"

Vulnerability::Vulnerability() {
	this->codes = std::vector<Code>();
	this->name = "null";
}

Vulnerability::Vulnerability(const std::string name, std::vector<Code> codes) {
	this->name = name;
	this->codes = codes;
}

const Vulnerability& Vulnerability::operator=(const Vulnerability& other) {
	this->name = other.name;
	this->codes = other.codes;
	return *this;
}

Vulnerability::Vulnerability(const Vulnerability& other) {
	*this = other;
}

std::string Vulnerability::getName() {
	return this->name;
}

std::vector<Code> Vulnerability::getCodes() {
	return this->codes;
}

bool Vulnerability::changeCodes() {
	bool keepSuccess = keepOriginalCode();
	if (!keepSuccess) {
		return false;
	}

	for (auto code : this->codes) {
		bool success = code.changeCode();
		if (!success) {
			return false;
		}
	}
	return true;
}

std::vector<std::string> Vulnerability::getUniquePaths() {
	std::vector<std::string> uniq;
	for (auto code : this->codes) {
		if (!isIn(uniq, code.getFilePath())) {
			uniq.push_back(code.getFilePath());
		}
	}
	return uniq;
}

bool Vulnerability::keepOriginalCode() {
	std::vector<std::string> uniq = this->getUniquePaths();
	std::string old = "old";
	std::string newPath;
	for (auto path : uniq) {
		newPath = path + old;
		if (!doesExist(newPath)) {
			bool success = moveCode(newPath, path);
			if (!success) {
				return false;
			}
		}
	}
	return true;
}

std::vector<strList> Vulnerability::vulnToLst() {
	std::vector<strList> attributes;
	for (auto item : this->codes) {
		attributes.push_back(item.codeToLst());
	}
	return attributes;
}

Vulnerability::~Vulnerability() {

}
